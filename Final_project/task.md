# 期末大作业：肝硬化超声波传播的数值模拟

## 项目背景

肝硬化是一种慢性肝病，会导致肝组织纤维化和声学性质改变。超声弹性成像技术通过测量组织对机械振动的响应来评估肝脏硬度，是诊断肝硬化的重要无创手段。本项目通过数值求解声波方程，模拟超声波在健康与硬化肝组织中的传播特性。

### 几何模型：采用二维同心圆模型

* **内圆**：半径 $R_{inner}$ 代表硬化区域，声速 $c_{hard} \approx 1600~m/s$
* **外环**：半径 $R_{outer}$ 代表健康肝组织，声速 $c_{normal} \approx 1550~m/s$
* **背景**：周围介质（水或脂肪），声速 $c_{bg} \approx 1450~m/s$

---

## 任务一：基础声波方程求解器开发

### 1.1 问题描述

开发二维声波方程的显式有限差分求解器，模拟超声波在肝硬化分层介质中的传播、反射和透射现象。

### 1.2 控制方程

2D声波方程：
$$\frac{\partial^{2}p}{\partial t^{2}}=c^{2}(x,y)\nabla^{2}p+s(x,y,t)$$

其中：

* $p(x,y,t)$：声压场 (Pa)
* $c(x,y)$：空间变化的声速场 ($m/s$)
* $s(x,y,t)$：源项（换能器激励）
* $\nabla^{2}=\frac{\partial^{2}}{\partial x^{2}}+\frac{\partial^{2}}{\partial y^{2}}$

初始条件：
$$p(x,y,0)=0, \quad \frac{\partial p}{\partial t}(x,y,0)=0$$

### 1.3 计算域与边界条件

* **计算域**：$\Omega=[0,0.1] \times [0,0.08]$ (单位：m)
* **几何模型**：
  * 内圆（硬化区）：圆心 $(x_{c},y_{c})=(0.05,0.04)$，半径 $R_{inner}=0.015~m$
  * 外圆（健康肝组织）：圆心同上，半径 $R_{outer}=0.025~m$
  * 背景：外圆之外为背景介质
* **边界条件**（在 $\partial\Omega$ 上）：
  * $\frac{\partial p}{\partial n}=0$
  * 即Neumann自由边界条件，或使用一阶外推：$p_{boundary}=p_{interior}$

### 1.4 源项设置

* **点源位置**：$(x_{s},y_{s})=(0.05,0.02)$ m（位于背景介质中，内圆下方）
* **源项形式 (Ricker子波)**：
    $$s(x,y,t)=A_{0}\cdot\delta(x-x_{s},y-y_{s})\cdot[1-2\pi^{2}f_{0}^{2}(t-t_{0})^{2}]exp[-\pi^{2}f_{0}^{2}(t-t_{0})^{2}]$$
    其中：
  * $A_{0}=10^{6}$ Pa（源强度）
  * $f_{0}=2\times10^{6}$ Hz（中心频率 2MHz）
  * $t_{0}=1/f_{0}$（时间偏移）
  * $\delta(x-x_{s},y-y_{s})$ 表示位于 $(x_{s},y_{s})$ 的空间脉冲
* **数值实现**：在网格点 $(i_{s},j_{s})$ 处添加源项，或使用小范围高斯分布近似点源。

### 1.5 离散化与稳定性

* **离散方法**：时间和空间均采用二阶中心差分格式，网格步长 $\Delta x=\Delta y=h$
* **CFL稳定性条件**（显式格式必须满足）：
    $$\Delta t\le\frac{h}{c_{max}\sqrt{2}}$$
    其中 $c_{max}$ 为计算域内的最大声速。特别注意：违反此条件将导致数值解爆炸性增长。

### 1.6 具体任务

* **a)** 实现显式有限差分求解器，在均匀介质中验证圆形波的传播，确保波速与理论值一致 (**30分**)
* **b)** 通过数值实验验证CFL条件：选取满足和违反CFL条件的时间步长，观察并记录数值稳定/不稳定现象 (**20分**)
* **c)** 构建同心圆肝硬化模型，从点源发出声波，可视化不同时刻的声压场分布，分析波在两个界面处的反射和透射现象 (**30分**)
* **d)** 在界面附近提取波形数据，测量反射波和透射波的幅值，与理论预测进行定性对比分析 (**20分**)

---

## 任务二：隐式格式与多重网格求解器

### 2.1 问题描述

针对任务一的声波方程，开发基于隐式时间离散的求解器，并研究不同迭代方法在求解线性方程组时的效率。

### 2.2 Crank-Nicolson隐式格式

* **时间离散**（二阶精度，无条件稳定）：
    $$\frac{p^{n+1}-2p^{n}+p^{n-1}}{\Delta t^{2}}=\frac{c^{2}}{2}[\nabla^{2}p^{n+1}+\nabla^{2}p^{n}]+s^{n}$$
* 每个时间步需求解线性方程组 $Ap^{n+1}=b$，其中系数矩阵 $A$ 由隐式项决定。

### 2.3 迭代求解方法

针对每个时间步产生的线性系统，需实现以下求解方法：

* **方法1：经典点迭代法**
  * Jacobi迭代
  * Gauss-Seidel迭代
  * SOR迭代（超松弛迭代）
* **方法2**：共轭梯度法
* **方法3**：几何多重网格

### 2.4 具体任务

* **a)** 实现Crank-Nicolson隐式格式，验证其在大时间步长下的稳定性（可超过CFL条件限制） (**25分**)
* **b)** 分别实现Jacobi、Gauss-Seidel、SOR、共轭梯度法四种迭代求解器，对于相同精度要求（相对残差 $<10^{-6}$），比较各方法的迭代次数和计算时间 (**30分**)
* **c)** 实现完整的几何多重网格V-cycle算法（至少两层网格），包括限制、延拓算子的构造，测试不同前后平滑次数对收敛速度的影响 (**35分**)
* **d)** 在不同网格尺寸下（如 $64^{2},128^{2},256^{2}$）测试所有方法，分析多重网格方法相对于单层迭代法的加速比和渐近复杂度 (**10分**)

---

## 任务三：剪切波弹性成像的声-弹耦合模拟

### 3.1 问题描述

在超声弹性成像中，通过聚焦超声在组织内部产生辐射力，激发剪切波（横波）传播。剪切波速度与组织弹性模量直接相关，测量剪切波速度可定量评估肝脏硬度。本任务模拟“声辐射力脉冲成像(ARFI)”过程。

### 3.2 两阶段物理模型

#### 阶段1：声辐射力激励

在组织内部焦点位置 $(x_{f},y_{f})=(0.05,0.04)$ (圆心位置) 施加体积力：
$$F(x,y,t)=F_{0}exp(-\frac{(x-x_{f})^{2}+{(y-y_{f})}^{2}}{2\sigma_{f}^{2}})\cdot g(t)\cdot\hat{y}$$

* 参数设置：
  * $F_{0}=10^{5}N/m^{3}$（辐射力强度）
  * $\sigma_{f}=2\times10^{-3}m$（焦点尺寸）
  * $g(t)=H(t)\cdot H(T_{p}-t)$ 方波调制， $T_{p}=0.2ms$（脉冲持续时间）
  * $\hat{y}$：沿y方向的单位矢量

#### 阶段2：剪切波传播

在辐射力作用下，组织产生位移场 $u(x,y,t)=(u_{x},u_{y})^{T}$，满足 2D弹性波方程（各向同性）：
$$\rho\frac{\partial^{2}u_{x}}{\partial t^{2}}=(\lambda+\mu)\frac{\partial}{\partial x}(\frac{\partial u_{x}}{\partial x}+\frac{\partial u_{y}}{\partial y})+\mu\nabla^{2}u_{x}$$
$$\rho\frac{\partial^{2}u_{y}}{\partial t^{2}}=(\lambda+\mu)\frac{\partial}{\partial y}(\frac{\partial u_{x}}{\partial x}+\frac{\partial u_{y}}{\partial y})+\mu\nabla^{2}u_{y}+F_{y}$$

**物性参数**（假设密度 $\rho=1000~kg/m^{3}$）：

* 背景介质：$\mu_{bg}=0$（液体无剪切模量），$\lambda_{bg}=2.1\times10^{9}$ Pa
* 健康肝组织：$\mu_{normal}=5\times10^{3}$ Pa，$\lambda_{normal}=2.4\times10^{9}$ Pa
* 硬化肝组织：$\mu_{hard}=2\times10^{4}$ Pa，$\lambda_{hard}=2.56\times10^{9}$ Pa

**波速关系**：

* 纵波速度：$c_{p}=\sqrt{\frac{\lambda+2\mu}{\rho}}$（约1500-1600 m/s）
* 剪切波速度：$c_{s}=\sqrt{\frac{\mu}{\rho}}$（健康组织约 2 m/s，硬化组织约 4.5 m/s）

### 3.3 离散化方案

* **空间离散**：使用二阶中心差分离散所有空间导数，网格步长 $h=\Delta x=\Delta y$
* **时间离散**：显式Leap-frog格式或标准中心差分
* **离散形式** ($u_{x}$ 为例)：
    $$u_{x,i,j}^{n+1}=2u_{x,i,j}^{n}-u_{x,i,j}^{n-1}+\frac{\Delta t^{2}}{\rho}[(\lambda+\mu)\frac{\partial\theta^{n}}{\partial x}|_{i,j}+\mu(\nabla^{2}u_{x}^{n})_{i,j}]$$
    其中散度 $\theta=\nabla\cdot u=\frac{\partial u_{x}}{\partial x}+\frac{\partial u_{y}}{\partial y}$ 用中心差分计算。
* **CFL条件**（由纵波速度决定）：
    $$\Delta t\le\frac{h}{c_{p,max}\sqrt{2}}$$

### 3.4 具体任务

* **a)** 实现2D弹性波方程求解器，在同心圆模型中设置不同的弹性模量，从焦点施加瞬时体积力，可视化位移场的时空演化 (**30分**)
* **b)** 在健康区和硬化区分别放置虚拟探测点，记录位移-时间曲线，使用互相关或峰值追踪法计算剪切波到达时间差，进而计算剪切波速度并与理论值对比 (**30分**)
* **c)** 计算位移场的散度 $\nabla\cdot u$ 和旋度 $\nabla\times u$ 分别可视化纯纵波和纯剪切波的传播模式，分析两种波的传播特性差异 (**20分**)
* **d)** 研究剪切波遇到硬化/健康组织界面时的反射和透射现象，分析界面对剪切波速度测量的影响 (**20分**)

---

## 提交要求

### 代码规范

* 提供完整可运行的源代码（推荐MATLAB或Python）
* 代码结构清晰，包含充分注释
* 参数可调（网格尺寸、时间步长、物性参数等）

### 报告内容

1. **理论推导 (15%)**：控制方程离散化、稳定性条件推导（如需）、收敛性分析（任务二）
2. **数值实现 (30%)**：算法流程说明、关键技术细节、数据结构设计（任务二的多重网格）
3. **结果与分析 (40%)**：可视化结果（波场快照、动画、剖面曲线）、定量分析（误差、收敛曲线、加速比等）、物理现象解释
4. **讨论 (15%)**：方法优缺点、数值结果与理论预测的对比、可能的改进方向

### 协作要求

* 三个任务可由不同成员负责，但需协调统一网格划分标准、模型几何参数、数据输出格式
* 鼓励任务间相互调用（如任务二使用任务一的结果，任务三使用任务二的求解器）

### 总分：100分

**加分项：**

* 实现任务三，个人final project成绩+10，团队其余成员+5
